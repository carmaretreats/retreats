---
import { SEO } from "astro-seo";
import '../styles/global.css';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
const {
  noindex = false,
  nofollow = false,
  disableCMP = false,
} = Astro.props;
---
<!doctype html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />

    <SEO
      title="Yoga Retreats Sri Lanka 2026 | Carma Retreats"
      description="Ankommen & Aufatmen - Yoga Retreats 2026 an Sri Lankas Südküste. Im Januar & Februar: Yoga, Kultur & Community unter tropischer Sonne."
      canonical="https://www.carma-retreats.com"
      noindex={noindex}
      nofollow={nofollow}
      extend={{
        link: [{ rel: "icon", href: "/favicon.ico" },
          { rel: "icon", type: "image/png", href: "/favicon-32x32.png" },
          { rel: "apple-touch-icon", href: "/apple-touch-icon.png" },
          { rel: "sitemap", href: "/sitemap-index.xml" }
        ],
        meta: [{ name: "theme-color", content: "#2d241d" },
                { property: "og:type", content: "website" },
                { property: "og:title", content: "Yoga Retreats Sri Lanka 2026 | Carma Retreats" },
                { property: "og:description", content: "Ankommen & Aufatmen – Yoga, Kultur & Community unter tropischer Sonne." },
                { property: "og:url", content: "https://www.carma-retreats.com" },
                { property: "og:image", content: "https://www.carma-retreats.com/images/og-preview.jpg" },
                { property: "og:locale", content: "de_DE" },
        ],
      }}
    />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-JGQ0MY9TF6"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() { dataLayer.push(arguments); }

      // Default: no consent until user accepts
      gtag("consent", "default", {
        ad_storage: "denied",
        analytics_storage: "denied",
      });

      gtag("js", new Date());
      gtag("config", "G-JGQ0MY9TF6"); 
    </script>

    <script
      defer
      src="https://cdn.jsdelivr.net/npm/@alpinejs/collapse@3.x.x/dist/cdn.min.js"
    ></script>
  </head>
  <body>
    { !disableCMP && (
      <>
        <script>
            window.onConsentAccept = function () {
              gtag("consent", "update", {
                ad_storage: "granted",
                analytics_storage: "granted",
              });

              setTimeout(() => {
                const loc = window.location;
                const pageLoc = loc.href;
                const pagePath = loc.pathname + loc.search;

                gtag("event", "page_view", {
                  page_title: document.title,
                  page_location: pageLoc,
                  page_path: pagePath,
                  page_referrer: document.referrer || "",
                });

                console.log("[GA4] Manual page_view sent with UTM:", pageLoc);
              }, 150);
            };
          </script>
          <script>
            const originalLog = console.log;
            const originalInfo = console.info;

            console.log = function (...args) {
              if (
                typeof args[0] === "string" &&
                (args[0].includes("dataLayer") || args[0].includes("CMP issue"))
              ) {
                return; // Ignora esos mensajes
              }
              originalLog.apply(console, args);
            };

            console.info = function (...args) {
              if (typeof args[0] === "string" && args[0].includes("CMP")) {
                return; // Ignora mensajes "CMP issue"
              }
              originalInfo.apply(console, args);
            };
          </script>
        <script type="text/javascript" data-cmp-ab="1" src="https://cdn.consentmanager.net/delivery/js/semiautomatic.min.js" data-cmp-cdid="9e402988c2ff1" data-cmp-host="b.delivery.consentmanager.net" data-cmp-cdn="cdn.consentmanager.net" data-cmp-codesrc="0" data-cmp-callback-onAccept="onConsentAccept"></script>
      </>
    )}
    <Header />
    <slot />
    <Footer />
  </body>
</html>

<style>
  html,
  body {
    margin: 0;
    width: 100%;
    height: 100%;
  }
</style>