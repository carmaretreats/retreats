---
import { Image } from 'astro:assets';
import logo from '../assets/images/Carma-Braun.png';
import MobileNav from './MobileNav.astro';
import DesktopNav from './DesktopNav.astro';
---

<header 
  class="w-full bg-cream-bg top-0 left-0 z-60"
  x-data="{
    open: false,
    busy: false,
    closeMenu() {
      if (this.busy) return;
      this.busy = true;
      const el = this.$refs.panel;
      // add closing class to trigger link fade-out
      el.classList.add('menu-closing');
      // wait for links to fade (match CSS delays) then actually close panel (remove menu-open)
      setTimeout(() => {
        this.open = false;
        // remove closing helper class after allowing panel slide animation to run
        el.classList.remove('menu-closing');
        // small timeout to allow panel to finish cleanup
        setTimeout(()=> { this.busy = false }, 60);
      }, 420); // matches links fade duration / stagger timing
    }
  }"
  x-init="$watch('open', v => document.body.classList.toggle('overflow-hidden', v))"
>
  <div class="max-w-screen-xl mx-auto px-4 sm:px-6 lg:px-8 h-[7.8rem] flex items-center relative">
    <div class="flex items-center flex-1 justify-start">
      <!-- Mobile animated hamburger -->
      <button
        class="sm:hidden text-black w-10 h-10 relative focus:outline-none bg-cream-bg flex items-center justify-center z-70"
        @click.prevent="if(!busy){ if(!open){ open = true } else { closeMenu() } }"
        :aria-expanded="open"
        aria-controls="mobile-menu"
        aria-label="Toggle menu"
      >
        <div class="block w-5 absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2">
          <span
            class="block absolute h-0.5 w-5 bg-current transform transition duration-500 ease-in-out"
            :class="{ 'rotate-45': open, '-translate-y-1.5': !open }"
            aria-hidden="true"
          ></span>
          <span
            class="block absolute h-0.5 w-5 bg-current transform transition duration-500 ease-in-out"
            :class="{ 'opacity-0': open }"
            aria-hidden="true"
          ></span>
          <span
            class="block absolute h-0.5 w-5 bg-current transform transition duration-500 ease-in-out"
            :class="{ '-rotate-45': open, 'translate-y-1.5': !open }"
            aria-hidden="true"
          ></span>
        </div>
      </button>

      <div class="hidden sm:flex sm:items-center">
        <DesktopNav side="left" />
      </div>
    </div>

    <!-- CENTER: logo -->
    <div class="absolute left-1/2 transform -translate-x-1/2 z-70">
      <a href="/" class="pointer-events-auto" aria-label="Home">
        <Image src={logo} alt="Carma Braun â€” Retreats logo" class="h-16 w-auto object-contain" />
      </a>
    </div>

    <!-- RIGHT -->
    <div class="flex items-center justify-end flex-1">
      <div class="hidden sm:flex sm:items-center">
        <DesktopNav side="right" />
      </div>
      <div class="w-6 sm:w-auto" aria-hidden="true"></div>
    </div>
  </div>

  <!-- Mobile overlay -->
  <div
    id="mobile-menu"
    x-ref="panel"
    role="dialog"
    aria-modal="true"
    aria-labelledby="mobile-menu-title"
    x-cloak
    :class="{ 'menu-open': open }"
    @click.self="if(!busy) closeMenu()"
    class="mobile-panel fixed inset-0 z-40 pointer-events-none"
  >
    <div class="mobile-panel-inner w-full h-full bg-white flex items-center justify-center p-6">
      <div class="max-w-screen-md w-full">
        <h2 id="mobile-menu-title" class="sr-only">Main menu</h2>
        <MobileNav />
      </div>
    </div>
  </div>
</header>